/*! For license information please see arcs.min.js.LICENSE.txt */
var t={d:(n,e)=>{for(var o in e)t.o(e,o)&&!t.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:e[o]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n)},n={};t.d(n,{Z:()=>m});var e={SourceIsNotComponent:{message:"Source is not a component"},UndefinedSignal:{message:"Signal is not defined"},UndefinedSlot:{message:"Slot is not defined"},create:function(t,n,e){return void 0===t.prototype?(console.error("Cannot create such a component"),0):(t.prototype.slots=[],t.prototype.signals={},t.slotList=function(){return t.prototype.slots},t.prototype.slotList=function(){return this.slots},t.prototype.signalList=function(){var t,n=[];for(t in this.signals)n.push(t);return n},t.signalList=function(){return t.prototype.signalList()},t.prototype.emit=function(t){var n,e,o,i=Array.prototype.slice.call(arguments,1);for(n in this.signals[t])e=this.signals[t][n].func,o=this.signals[t][n].obj,e.apply(o,i)},t.prototype.slot=function(n,e){this.hasOwnProperty("slots")||(this.slots=t.prototype.slots.map((t=>t))),this.slots.push(n),this[n]=e},t.prototype.signal=function(n){this.hasOwnProperty("signals")||(this.signals={},Object.assign(this.signals,t.prototype.signals)),this.signals[n]=1},t.slot=function(n,e){var o;if(n instanceof Array)for(o=0;o<n.length;o++)t.prototype.slots.push(n[o]);else t.prototype.slots.push(n),void 0!==e&&(t.prototype[n]=e)},t.signal=function(n){var e;if(n instanceof Array)for(e=0;e<n.length;e++)t.prototype.signals[n[e]]=[];else t.prototype.signals[n]=[]},void 0!==n&&t.slot(n),void 0!==e&&t.signal(e),t)},check:function(t){return void 0!==t.prototype&&void 0!==t.prototype.signals&&void 0!==t.prototype.slots},connect:function(t,n,o,i){var r,s;if(void 0===t.signals)throw e.SourceIsNotComponent;if(void 0===t.signals[n]){let t=Object.assign({},e.UndefinedSignal);throw t.message=t.message+': "'+n+'"',t}if(void 0===o[i]){let t=Object.assign({},e.UndefinedSlot);throw t.message=t.message+': "'+i+'"',t}if(!t.hasOwnProperty("signals"))for(s in r=t.signals,t.signals={},r)t.signals[s]=[];t.signals[n].push({obj:o,func:o[i]})},disconnect:function(t,n,e,o){var i;for(i=0;i<t.signals[n].length;i++)t.signals[n][i].obj===e&&t.signals[n][i].func===e[o]&&(t.signals[n].splice(i,1),i--)},invoke:function(t,n,o){if(void 0===t[n])throw e.UndefinedSlot;t[n].apply(t,o)},config:function(t,n){"function"==typeof t.config&&t.config(n)}};const o=e,i=function(t,n){this.eval=function(){return t[n]}},r=function(t,n,e){this.eval=function(){return n.eval(t)||e.eval(t)}},s=function(t,n,e){this.eval=function(t){return n.eval(t)&&n.eval(t)}};let a={build:function(t,n){var e,o,c,u;if("string"==typeof t)return n[t]=n[t]??!1,new i(n,t);for(e=a.build(t[0],n),u=1;u<t.length;u++)t[u].hasOwnProperty("and")?(c=a.build(t[u].and,n),o=new s(n,e,c)):t[u].hasOwnProperty("or")?(c=a.build(t[u].or,n),o=new r(n,e,c)):console.warn("[ARCS] Illegal tree"),e=o;return e}};const c=a,u=function(){function t(t,n,e,o,i,r){this.message=t,this.expected=n,this.found=e,this.offset=o,this.line=i,this.column=r,this.name="SyntaxError"}return function(t,n){function e(){this.constructor=t}e.prototype=n.prototype,t.prototype=new e}(t,Error),{SyntaxError:t,parse:function(n){var e,o=arguments.length>1?arguments[1]:{},i={},r={start:Z},s=Z,a=i,c=function(t,n){return[t].concat(n)},u=function(t){return{and:t}},l=function(t){return{or:t}},f=function(t){return t},h="(",p={type:"literal",value:"(",description:'"("'},d=")",g={type:"literal",value:")",description:'")"'},v=function(t){return[t]},y={type:"other",description:"id"},C=function(t){return t.trim()},m=/^[_a-zA-Z]/,w={type:"class",value:"[_a-zA-Z]",description:"[_a-zA-Z]"},S=/^[_a-zA-Z0-9]/,A={type:"class",value:"[_a-zA-Z0-9]",description:"[_a-zA-Z0-9]"},O="&",P={type:"literal",value:"&",description:'"&"'},x="|",b={type:"literal",value:"|",description:'"|"'},R=/^[ \r\n\t]/,F={type:"class",value:"[ \\r\\n\\t]",description:"[ \\r\\n\\t]"},j=0,N=0,T={line:1,column:1,seenCR:!1},k=0,L=[],E=0;if("startRule"in o){if(!(o.startRule in r))throw new Error("Can't start parsing from rule \""+o.startRule+'".');s=r[o.startRule]}function I(t){return N!==t&&(N>t&&(N=0,T={line:1,column:1,seenCR:!1}),function(t,e,o){var i,r;for(i=e;i<o;i++)"\n"===(r=n.charAt(i))?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===r||"\u2028"===r||"\u2029"===r?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}(T,N,t),N=t),T}function _(t){j<k||(j>k&&(k=j,L=[]),L.push(t))}function U(e,o,i){var r=I(i),s=i<n.length?n.charAt(i):null;return null!==o&&function(t){var n=1;for(t.sort((function(t,n){return t.description<n.description?-1:t.description>n.description?1:0}));n<t.length;)t[n-1]===t[n]?t.splice(n,1):n++}(o),new t(null!==e?e:function(t,n){var e,o=new Array(t.length);for(e=0;e<t.length;e++)o[e]=t[e].description;return"Expected "+(t.length>1?o.slice(0,-1).join(", ")+" or "+o[t.length-1]:o[0])+" but "+(n?'"'+function(t){function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x80-\xFF]/g,(function(t){return"\\x"+n(t)})).replace(/[\u0180-\u0FFF]/g,(function(t){return"\\u0"+n(t)})).replace(/[\u1080-\uFFFF]/g,(function(t){return"\\u"+n(t)}))}(n)+'"':"end of input")+" found."}(o,s),o,s,i,r.line,r.column)}function Z(){return D()}function D(){var t,n,e,o;if(t=j,(n=z())!==i){if(e=[],(o=q())!==i)for(;o!==i;)e.push(o),o=q();else e=a;e!==i?t=n=c(n,e):(j=t,t=a)}else j=t,t=a;return t===i&&(t=z()),t}function q(){var t,n;return t=j,M()!==i&&(n=z())!==i?t=u(n):(j=t,t=a),t===i&&(t=j,B()!==i&&(n=z())!==i?t=l(n):(j=t,t=a)),t}function z(){var t,e,o,r;return t=j,(e=V())!==i&&(e=f(e)),(t=e)===i&&(t=j,40===n.charCodeAt(j)?(e=h,j++):(e=i,0===E&&_(p)),e!==i&&(o=D())!==i?(41===n.charCodeAt(j)?(r=d,j++):(r=i,0===E&&_(g)),r!==i?t=e=v(o):(j=t,t=a)):(j=t,t=a)),t}function V(){var t,e,o;return E++,t=j,e=j,(o=J())!==i&&(o=n.substring(e,j)),(e=o)!==i&&(e=C(e)),E--,(t=e)===i&&(e=i,0===E&&_(y)),t}function J(){var t,e,o,r,s;if(t=j,(e=$())!==i)if(m.test(n.charAt(j))?(o=n.charAt(j),j++):(o=i,0===E&&_(w)),o!==i){for(r=[],S.test(n.charAt(j))?(s=n.charAt(j),j++):(s=i,0===E&&_(A));s!==i;)r.push(s),S.test(n.charAt(j))?(s=n.charAt(j),j++):(s=i,0===E&&_(A));r!==i&&(s=$())!==i?t=e=[e,o,r,s]:(j=t,t=a)}else j=t,t=a;else j=t,t=a;return t}function M(){var t,e,o,r;return t=j,(e=$())!==i?(38===n.charCodeAt(j)?(o=O,j++):(o=i,0===E&&_(P)),o!==i&&(r=$())!==i?t=e=[e,o,r]:(j=t,t=a)):(j=t,t=a),t}function B(){var t,e,o,r;return t=j,(e=$())!==i?(124===n.charCodeAt(j)?(o=x,j++):(o=i,0===E&&_(b)),o!==i&&(r=$())!==i?t=e=[e,o,r]:(j=t,t=a)):(j=t,t=a),t}function $(){var t,e;for(t=[],R.test(n.charAt(j))?(e=n.charAt(j),j++):(e=i,0===E&&_(F));e!==i;)t.push(e),R.test(n.charAt(j))?(e=n.charAt(j),j++):(e=i,0===E&&_(F));return t}if((e=s())!==i&&j===n.length)return e;throw e!==i&&j<n.length&&_({type:"end",description:"end of input"}),U(null,L,k)}}}(),l=o.create((function(t){var n="",e="",o={},i="",r=this,s={},a={},l={},f=function(t){var n;r.slots.indexOf(t)<0&&r.slot(t,(n=t,function(){r.setToken(n)}))},h=function(t){var n;if(Object.keys(a).forEach((t=>a[t]=!1)),o.hasOwnProperty(t))for(n in a={},o[t])o[t].hasOwnProperty(n)&&(l[n]=c.build(s[t][n],a));i=t,r.emit("requestSheet",i),i===e&&r.emit("requestTermination")};this.setInitialState=function(t){i=n=t},this.setFinalState=function(t){e=t},this.addTransition=function(t,n,e){var i,r=/([A-Za-z_]\w*)/g;try{var a;if("string"==typeof(a=u.parse(n)))f(a);else for(;null!==(i=r.exec(n));)f(i[0]);s[t]=s[t]||{},s[t][n]=a,void 0===o[t]&&(o[t]={}),o[t][n]=e}catch(t){}},this.setToken=function(t){a.hasOwnProperty(t)&&(a[t]=!0);for(const[t,n]of Object.entries(l))n.eval()&&(l={},h(o[i][t]))},this.setTransitions=function(t){var n,e;for(n in t)if(t.hasOwnProperty(n))for(e in t[n])t[n].hasOwnProperty(e)&&this.addTransition(n,e,t[n][e])},this.start=function(){h(n)},void 0!==t&&(n=t.initial,e=t.final,this.setTransitions(t.transitions),i="")}),["setToken"],["requestSheet","requestTermination"]);let f=function(t){let n={},e={},o={},i=[],r=this,s=!1;if(o.StateMachine=l,void 0!==t){var a;for(a in i=t.libraries,t.components)t.components.hasOwnProperty(a)&&(n[a]=t.components[a]);if(void 0!==t.constants)for(a in t.constants)t.constants.hasOwnProperty(a)&&(e[a]=t.constants[a])}var c=async function(t){return m()?new Promise((function(n,e){var o=require(t);void 0!==o?n(o):e("[ARCS] File not found")})):(await fetch(t)).json()};this.loadLibrary=function(t,n){var e=t,o=t;return f.currentContext=r,"string"!=typeof t&&(o=t.name,e=t.url),i.indexOf(o)<0&&i.push(o),import(e).then((function(t){for(a in t.default)t.default.hasOwnProperty(a)&&f.currentContext.setFactory(a,t.default[a]);void 0!==n&&n()})).catch((function(t){console.error("[ARCS] Trouble loading '",e,"' with reason -",{msg:t})}))},this.getComponentList=function(){var t,e=Object.keys(n);for(t=0;t<e.length;t++)n.hasOwnProperty(e[t])||e.splice(t--,1);return e},this.getConstant=function(t){return e[t]},this.getComponentType=function(t){if(void 0!==n[t])return n[t].type},this.getComponentValue=function(t){if(void 0!==n[t])return n[t].value},this.getComponent=function(t){if(void 0!==n[t])return n[t].instance},this.getComponentName=function(t){var e,o;for(o=n.getComponentList(),e=0;e<o.length;e++)if(n[o[e]].instance===t)return o[e]},this.addFactories=function(t){for(a in s=!0,t)t.hasOwnProperty(a)&&(o[a]=t[a])},this.setFactory=function(t,n){o[t]=n},this.toJSON=function(){var t,e={};for(t in n)n.hasOwnProperty(t)&&(e[t]={type:n[t].type,value:n[t].value});return e},this.setComponentValue=function(t,e){n[t].value=e},this.addComponent=function(t,e,i){var r;n[t]={},n[t].type=e,n[t].value=i;var s=o[e];void 0!==s&&(r=new s(i)),n[t].instance=r},this.removeComponent=function(t){delete n[t]},this.getFactory=function(t){return o[t]},this.getFactoryList=function(){return Object.keys(o)},this.instanciate=async function(){try{s||await function(){var t;f.currentContext=r;var n=[];for(t=0;t<i.length;t++)n.push(r.loadLibrary(i[t]));return Promise.all(n)}(),await async function(){var t,r=[];for(t in n)if(n.hasOwnProperty(t)){if(void 0===o[n[t].type])return console.error("[ARCS] Factory "+n[t].type+" not found."),void console.error("[ARCS] Context dump follows: ",i,n,e);var s=o[n[t].type];try{void 0!==n[t].value||void 0!==n[t].url||void 0!==n[t].ref?(void 0!==n[t].value&&(n[t].instance=new s(n[t].value)),void 0!==n[t].url&&(console.log("loading data file",n[t].url),r.push(c(n[t].url).then(function(t,e){return function(o){return console.log("instanciating from data file"),n[t].instance=new e(o),Promise.resolve()}}(t,s)))),void 0!==n[t].ref&&void 0!==e[n[t].ref]&&(n[t].instance=new s(e[n[t].ref]))):n[t].instance=new s}catch(n){console.error("[ARCS] Component of type ",t," not instanciated.",n)}}return Promise.all(r)}()}catch(t){console.error("[ARCS] Trouble instanciating context",t)}};var u=function(t,n){var e,o=Object.create(n);for(e in t)t.hasOwnProperty(e)&&(o[e]=t[e]);return o};this.chain=function(t,i,r){return[u(t,n),u(i,e),u(r,o)]},this.setParent=function(t){if(void 0!==t){var i=t.chain(n,e,o);n=i[0],e=i[1],o=i[2]}}};f.currentContext=null;const h=f;let p=function(t,n,e){this.getDestination=function(){return t},this.getSlot=function(){return n},this.getValue=function(){return e},this.invoke=function(){var o=t[n];void 0!==o?o.apply(t,e):console.error("Undefined slot %s of component %s",n,t)}};p.cast=function(t,n){let e=n.getComponent(t.destination);if(void 0===e&&console.error("[ARCS] Destination ",t.destination," is undefined"),void 0!==t.value)return new p(e,t.slot,t.value);if(void 0!==t.ref)return new p(e,t.slot,n.getConstant(t.ref));if(void 0!==t.storage){let n=null;return"undefined"!=typeof localStorage&&null===localStorage.getItem(`ARCS.${storage.key}`)&&void 0!==t.storage.default&&(n=t.storage.default),new p(e,t.slot,n)}},p.PRE_CONNECTION=0,p.POST_CONNECTION=1,p.CLEAN_UP=2;const d=p;let g=function(t,n,e,i){this.connect=function(){try{o.connect(t,n,e,i)}catch(o){console.log(o,t,n,e,i)}},this.disconnect=function(){o.disconnect(t,n,e,i)},this.getSource=function(){return t},this.getDestination=function(){return e},this.getSlot=function(){return i},this.getSignal=function(){return n}};g.cast=function(t,n){return new g(n.getComponent(t.source),t.signal,n.getComponent(t.destination),t.slot)};const v=g,y=function(t){var n,e,o,i,r,s=new h,a=[],c=[],u=[],l=[],f=0,p=0,g=0,y=0;n=function(){var t;for(t=0;t<a.length;t++)a[t].invoke()},e=function(){var t;for(t=0;t<c.length;t++)c[t].invoke()},o=function(){var t;for(t=0;t<u.length;t++)u[t].invoke()},i=function(){var t;for(t=0;t<l.length;t++)l[t].connect()},r=function(){var t;for(t=0;t<l.length;t++)l[t].disconnect()},this.setContext=function(t){s=t},this.activate=function(){s.instanciate().then((function(){n(),i(),e()}))},this.deactivate=function(){r(),o()},this.addPreConnection=function(t){var n=d.cast(t,s);return n.id=f++,a.push(n),n.id},this.addPostConnection=function(t){var n=d.cast(t,s);return n.id=p++,c.push(n),n.id},this.addCleanup=function(t){var n=d.cast(t,s);return n.id=g++,u.push(n),n.id},this.addConnection=function(t){var n=v.cast(t,s);return n.id=y++,l.push(n),n.id};var C=function(t,n){for(var e=n.length;e--&&n[e].id!==t;);e>=0?n.splice(e,1):console.warn("Could not remove data with id",t)};this.removePreConnection=function(t){C(t,a)},this.removePostConnection=function(t){C(t,c)},this.removeCleanup=function(t){C(t,u)};var m=function(t,n,e){for(var o=e.length;o--&&e[o].id!==t;);o>=0&&(e[o].value=n)};this.changePreConnection=function(t,n){m(t,n,a)},this.changePostConnection=function(t,n){m(t,n,c)},this.changeCleanup=function(t,n){m(t,n,u)},this.removeConnection=function(t){C(t,l)};var w=function(t,n,e){for(var o,i=e.length,r=e.length;i--&&e[i].id!==t;);for(;r--&&e[r].id!==n;);i>=0&&r>=0&&(o=e[i],e[i]=e[r],e[r]=o,e[i].id=t,e[r].id=n)};this.swapConnections=function(t,n){w(t,n,l)},this.swapCleanups=function(t,n){w(t,n,u)},this.swapPreConnections=function(t,n){w(t,n,a)},this.swapPostConnections=function(t,n){w(t,n,c)},this.import=function(n){n.hasOwnProperty("context")&&(s=new h(n.context)).setParent(t),s.instanciate().then((function(){!function(t){var n=0,e=d.cast,o=v.cast;for(n=0;n<t.preconnections.length;n++)a.push(e(t.preconnections[n],s));for(n=0;n<t.postconnections.length;n++)c.push(e(t.postconnections[n],s));for(n=0;n<t.cleanups.length;n++)u.push(e(t.cleanups[n],s));for(n=0;n<t.connections.length;n++)l.push(o(t.connections[n],s))}(n)}))};var S=function(t){return{destination:s.getComponentName(t.getDestination()),slot:t.getSlot(),value:t.getValue()}};this.toJSON=function(){var t,n,e=[],o=[],i=[],r=[];for(t=0;t<l.length;t++)i.push((n=l[t],{source:s.getComponentName(n.getSource()),signal:n.getSignal(),destination:s.getComponentName(n.getDestination()),slot:n.getSlot()}));for(t=0;t<a.length;t++)e.push(S(a[t]));for(t=0;t<c.length;t++)o.push(S(c[t]));for(t=0;t<u.length;t++)r.push(S(u[t]));return{preconnections:e,postconnections:o,connections:i,cleanups:r}},s.setParent(t)};let C=function(){var t=new h,n={},e={},i=[],r=this,s="";this.export=function(){return{context:t,controller:t.getComponentName(e),sheets:n}},this.getContext=function(){return t},this.getSheetList=function(){return Object.keys(n)},this.getSheet=function(t){return n[t]},this.addSheet=function(e,o){n[e]=o,o.setContext(t)},this.removeSheet=function(t){delete n[t]},this.launch=function(){var i,s,a;if(console.log("[ARCS] Starting application..."),s=t.getComponent(e),void 0!==(e=s)){for(a=Object.keys(n),i=0;i<a.length;i++)(s=new y(t)).import(n[a[i]],t),n[a[i]]=s;o.connect(e,"requestSheet",r,"setSheet"),o.connect(e,"requestTermination",r,"finish"),e.start()}else console.error("[ARCS] undefined controller")},this.setController=function(n){e=t.getComponent(n)},this.setSheet=function(t){n.hasOwnProperty(t)?(s&&n[s].deactivate(),n[s=t].activate()):console.warn("[ARCS] Tried to activate hollow sheet named: "+t)},this.finish=function(){s&&n[s].deactivate()},this.import=function(o){t=new h(o.context),n=o.sheets,void 0===(e=o.controller)&&console.error("[ARCS] Undefined controller. Cannot start application.")},this.setFactory=function(t,n){factories[t]=n},this.setDependency=function(t){i[t]={}},this.start=async function(){console.log("[ARCS] Instanciating components..."),await t.instanciate(),this.launch()}};C.setDependency=function(t,n){t.setDependency(n)},o.create(C),C.slot("setSheet"),C.slot("finish");const m={Component:o,isInNode:function(){return"undefined"!=typeof process&&-1!==process.release.name.search(/node|io.js/)},StateMachine:l,Context:h,Invocation:d,Connection:v,Sheet:y,Application:C};var w=n.Z;export{w as default};